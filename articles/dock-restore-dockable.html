<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>RestoreDockable Behavior and Splitter Management | Dock for Avalonia </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="RestoreDockable Behavior and Splitter Management | Dock for Avalonia ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/wieslawsoltes/Dock/blob/master/docfx/articles/dock-restore-dockable.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="restoredockable-behavior-and-splitter-management">RestoreDockable Behavior and Splitter Management</h1>

<p>This guide explains the <code>RestoreDockable</code> functionality in the Dock library, its behavior regarding splitter management, and recent optimizations to prevent unwanted splitter creation.</p>
<h2 id="overview">Overview</h2>
<p>The <code>RestoreDockable</code> method is responsible for moving hidden dockables back to their original visible locations within the docking layout. This functionality is essential for applications that support hiding and showing dock panels dynamically.</p>
<h2 id="method-signatures">Method Signatures</h2>
<p>The <code>IFactory</code> interface provides two overloads for restoring dockables:</p>
<pre><code class="lang-csharp">/// &lt;summary&gt;
/// Restores a hidden dockable to its original dock.
/// &lt;/summary&gt;
/// &lt;param name=&quot;dockable&quot;&gt;The dockable to restore.&lt;/param&gt;
void RestoreDockable(IDockable dockable);

/// &lt;summary&gt;
/// Restores a hidden dockable to its original dock.
/// &lt;/summary&gt;
/// &lt;param name=&quot;id&quot;&gt;The dockable id.&lt;/param&gt;
/// &lt;returns&gt;The restored dockable or null.&lt;/returns&gt;
IDockable? RestoreDockable(string id);
</code></pre>
<h2 id="behavior">Behavior</h2>
<h3 id="basic-restoration-process">Basic Restoration Process</h3>
<ol>
<li><strong>Find Root Dock</strong>: Locates the root dock that contains the hidden dockable</li>
<li><strong>Validate Hidden State</strong>: Checks if the dockable exists in the <code>HiddenDockables</code> collection</li>
<li><strong>Remove from Hidden</strong>: Removes the dockable from <code>HiddenDockables</code></li>
<li><strong>Fire Restored Event</strong>: Triggers the <code>DockableRestored</code> event</li>
<li><strong>Restore to Original Owner</strong>: If the dockable has an <code>OriginalOwner</code>, adds it back to that dock's <code>VisibleDockables</code></li>
<li><strong>Update Ownership</strong>: Sets the dockable's <code>Owner</code> to the original owner and clears <code>OriginalOwner</code></li>
<li><strong>Update DockingState</strong>: Recomputes <code>IDockable.DockingState</code> for the restored dockable and descendants (for example clears <code>Hidden</code> and restores <code>Docked</code>/<code>Pinned</code>/<code>Document</code> with optional <code>Floating</code>)</li>
<li><strong>Fire Added Event</strong>: Triggers the <code>DockableAdded</code> event</li>
</ol>
<h3 id="string-overload-behavior">String Overload Behavior</h3>
<p>The string overload (<code>RestoreDockable(string id)</code>) searches all root docks returned by the factory (<code>Find(d =&gt; d is IRootDock)</code>) and looks for a hidden dockable with the specified ID. If found, it calls the main <code>RestoreDockable(IDockable)</code> method.</p>
<h2 id="splitter-management">Splitter Management</h2>
<p><code>RestoreDockable</code> does not create splitters automatically. The layout optimization system handles splitter creation and cleanup automatically as needed.</p>
<h3 id="current-implementation">Current Implementation</h3>
<pre><code class="lang-csharp">if (dockable.OriginalOwner is IDock owner)
{
    AddVisibleDockable(owner, dockable);
    OnDockableAdded(dockable);
    dockable.Owner = owner;
    dockable.OriginalOwner = null;
    UpdateDockingWindowStateRecursive(dockable);
}
</code></pre>
<h3 id="design-principles">Design Principles</h3>
<ol>
<li><strong>Layout Consistency</strong>: Splitter management is centralized in the layout optimization system</li>
<li><strong>Automatic Management</strong>: Splitters are created and removed based on actual layout needs</li>
<li><strong>Simplified Logic</strong>: RestoreDockable focuses solely on moving dockables between collections</li>
</ol>
<h3 id="splitter-integration">Splitter Integration</h3>
<p>The layout system handles splitters through:</p>
<ul>
<li><code>CleanupOrphanedSplitters()</code>: Removes splitters at beginnings/ends and consecutive splitters</li>
<li><code>RemoveDockable()</code>: Automatically cleans up splitters after dockable removal</li>
<li><code>SplitToDock()</code>: Creates splitters only when needed for new split operations</li>
</ul>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="basic-restoration">Basic Restoration</h3>
<pre><code class="lang-csharp">// Hide a dockable
factory.HideDockable(myDocument);

// Later, restore it
factory.RestoreDockable(myDocument);

// Or restore by ID
var restored = factory.RestoreDockable(&quot;MyDocumentId&quot;);
</code></pre>
<h3 id="event-handling">Event Handling</h3>
<pre><code class="lang-csharp">factory.DockableRestored += (sender, args) =&gt;
{
    Console.WriteLine($&quot;Restored: {args.Dockable.Title}&quot;);
};

factory.DockableAdded += (sender, args) =&gt;
{
    Console.WriteLine($&quot;Added back to dock: {args.Dockable.Title}&quot;);
};
</code></pre>
<h3 id="error-handling">Error Handling</h3>
<pre><code class="lang-csharp">// Restore by ID with error handling
var restored = factory.RestoreDockable(&quot;MyDocumentId&quot;);
if (restored == null)
{
    Console.WriteLine(&quot;Dockable not found or not hidden&quot;);
}
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="dos">Do's</h3>
<ul>
<li>✅ Use the direct dockable overload when you have a reference to the dockable</li>
<li>✅ Use the string overload when working with serialized layouts or IDs</li>
<li>✅ Handle the case where string restoration returns null</li>
<li>✅ Let the layout optimization handle splitter management automatically</li>
</ul>
<h3 id="donts">Don'ts</h3>
<ul>
<li>❌ Don't manually create splitters before or after calling <code>RestoreDockable</code></li>
<li>❌ Don't assume splitters will be automatically created during restoration</li>
<li>❌ Don't modify <code>OriginalOwner</code> manually - let the factory manage this property</li>
</ul>
<h2 id="error-conditions">Error Conditions</h2>
<table>
<thead>
<tr>
<th>Condition</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dockable</code> is null</td>
<td>Not expected; the API requires a non-null dockable</td>
</tr>
<tr>
<td>Root dock not found</td>
<td>Method returns early, no action taken</td>
</tr>
<tr>
<td><code>HiddenDockables</code> is null</td>
<td>Method returns early, no action taken</td>
</tr>
<tr>
<td>Dockable not in <code>HiddenDockables</code></td>
<td>Method returns early, no action taken</td>
</tr>
<tr>
<td><code>OriginalOwner</code> is null</td>
<td>Sets dockable's <code>Owner</code> to null</td>
</tr>
<tr>
<td><code>OriginalOwner.VisibleDockables</code> is null</td>
<td>Creates new collection and adds dockable</td>
</tr>
</tbody>
</table>
<h2 id="testing">Testing</h2>
<p>The library includes comprehensive unit tests covering:</p>
<ul>
<li>Basic restoration scenarios</li>
<li>Multiple dockables restoration</li>
<li>Different dock types (ToolDock, DocumentDock, ProportionalDock)</li>
<li>Edge cases and error conditions</li>
<li>Event firing verification</li>
<li><strong>Splitter behavior verification</strong> (ensures correct splitter management)</li>
</ul>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="dock-events.html">Dock events</a></li>
<li><a href="dock-state.html">Dock state guide</a></li>
<li><a href="dock-manager-guide.html">DockManager guide</a></li>
</ul>
<h2 id="implementation-notes">Implementation Notes</h2>
<p>When working with <code>RestoreDockable</code>:</p>
<ol>
<li>Splitter management is handled automatically by the layout system</li>
<li>Focus on the dockable restoration logic rather than splitter concerns</li>
<li>The layout optimization ensures consistent splitter behavior across all operations</li>
<li>Splitters are serialized and restored through the standard layout persistence mechanism</li>
</ol>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/wieslawsoltes/Dock/blob/master/docfx/articles/dock-restore-dockable.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
